<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timbre 2024-07-08 09:20</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.10.3/dist/cdn.min.js" defer></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="flex items-center justify-center h-screen bg-gray-100">
    <div x-data="telegramBot()" x-init="getLocation" class="text-center">
        <button 
            x-bind:disabled="!locationGranted" 
            @click="sendMessage" 
            class="px-8 py-4 bg-blue-500 text-white text-xl font-bold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
            Tocar Timbre
        </button>
    </div>

    <script>
        function telegramBot() {
            return {
                botToken: '7247263560:AAF6PpVlY9TbO5SpQHnzFGNu0D1HBbSPuhc',
                chatId: '-4286332749',
                message: 'Puerta',
                latitude: null,
                longitude: null,
                locationGranted: false,
                getLocation() {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(position => {
                            this.latitude = position.coords.latitude;
                            this.longitude = position.coords.longitude;
                            this.message = `Mi ubicación actual es:\nLatitud: ${this.latitude}\nLongitud: ${this.longitude}`;
                            this.locationGranted = true;
                        }, error => {
                            console.error('Error al obtener la geolocalización:', error);
                            this.message = 'No se pudo obtener la geolocalización.';
                            this.locationGranted = false;
                        });
                    } else {
                        console.error('Geolocalización no soportada por este navegador.');
                        this.message = 'Geolocalización no soportada por este navegador.';
                        this.locationGranted = false;
                    }
                },
                sendMessage() {
                    if (this.locationGranted) {
                        fetch(`https://api.telegram.org/bot${this.botToken}/sendMessage`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                chat_id: this.chatId,
                                text: this.message
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Mensaje enviado:', data);
                        })
                        .catch(error => {
                            console.error('Error al enviar mensaje:', error);
                        });
                    } else {
                        console.error('Permisos de geolocalización no concedidos.');
                    }
                }
            };
        }
    </script>
</body>
</html>
